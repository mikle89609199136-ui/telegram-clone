<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Zhuravlev Telegram</title>
  <style>
    /* ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    /* –ë–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ (—Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
    body {
      --bg-color: #0e1621;
      --surface-color: #17212b;
      --border-color: #2b3b4a;
      --text-primary: #fff;
      --text-secondary: #8e9eae;
      --accent-color: #2ea6ff;
      --message-own: #2ea6ff;
      --message-other: #17212b;
      background-color: var(--bg-color);
      color: var(--text-primary);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: background 0.2s, color 0.2s;
    }

    /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
    body.light-theme {
      --bg-color: #f5f5f5;
      --surface-color: #ffffff;
      --border-color: #e0e0e0;
      --text-primary: #000000;
      --text-secondary: #5e6f7e;
      --accent-color: #2ea6ff;
      --message-own: #2ea6ff;
      --message-other: #e4e6eb;
    }

    /* –°–∏–Ω—è—è —Ç–µ–º–∞ */
    body.blue-theme {
      --bg-color: #1a2b3c;
      --surface-color: #1e3a5f;
      --border-color: #2c4a6e;
      --accent-color: #64b5f6;
      --message-own: #64b5f6;
      --message-other: #1e3a5f;
    }

    /* –ó–µ–ª—ë–Ω–∞—è —Ç–µ–º–∞ */
    body.green-theme {
      --bg-color: #1a2e1a;
      --surface-color: #1f4a2c;
      --border-color: #2a5e3a;
      --accent-color: #81c784;
      --message-own: #81c784;
      --message-other: #1f4a2c;
    }

    /* –§–∏–æ–ª–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞ */
    body.purple-theme {
      --bg-color: #1e1a2e;
      --surface-color: #312a4a;
      --border-color: #453c63;
      --accent-color: #b39ddb;
      --message-own: #b39ddb;
      --message-other: #312a4a;
    }

    /* ========== –û–°–ù–û–í–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ ========== */
    .screen {
      display: none;
      height: 100%;
      flex-direction: column;
    }
    .screen.active {
      display: flex;
    }

    .top-bar {
      background: var(--surface-color);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
    }
    .top-bar h1 {
      flex: 1;
      font-size: 20px;
      font-weight: 600;
    }
    .top-bar .edit-btn, .top-bar .create-btn, .top-bar .back-btn {
      background: none;
      border: none;
      color: var(--accent-color);
      font-size: 16px;
      margin-right: 16px;
      cursor: pointer;
    }
    .top-bar .back-btn {
      font-size: 24px;
      margin-right: 12px;
    }
    .top-bar .create-btn {
      font-size: 24px;
    }

    .search-box {
      padding: 8px 16px;
      background: var(--surface-color);
    }
    .search-box input {
      width: 100%;
      padding: 12px 18px;
      background: var(--border-color);
      border: none;
      border-radius: 24px;
      color: var(--text-primary);
      outline: none;
    }
    .search-box input::placeholder {
      color: var(--text-secondary);
    }

    .bottom-nav {
      display: flex;
      background: var(--surface-color);
      border-top: 1px solid var(--border-color);
      padding: 8px 0;
    }
    .nav-item {
      flex: 1;
      text-align: center;
      color: var(--text-secondary);
      font-size: 12px;
      padding: 8px;
      cursor: pointer;
    }
    .nav-item.active {
      color: var(--accent-color);
    }
    .nav-item i {
      display: block;
      font-size: 24px;
      margin-bottom: 4px;
    }

    /* –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ */
    .chats-list {
      flex: 1;
      overflow-y: auto;
      padding: 0;
    }
    .chat-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      background: var(--bg-color);
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }
    .chat-item:hover {
      background: var(--surface-color);
    }
    .chat-item.edit-mode {
      padding-left: 56px;
    }
    .chat-checkbox {
      position: absolute;
      left: 16px;
      width: 24px;
      height: 24px;
      background: var(--surface-color);
      border: 2px solid var(--border-color);
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
    .chat-item.edit-mode .chat-checkbox {
      display: flex;
    }
    .chat-checkbox.selected {
      background: var(--accent-color);
      border-color: var(--accent-color);
    }
    .chat-checkbox.selected::after {
      content: '‚úì';
    }
    .chat-avatar {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background: var(--accent-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #fff;
      margin-right: 12px;
      flex-shrink: 0;
    }
    .chat-info {
      flex: 1;
      min-width: 0;
    }
    .chat-name {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .chat-last-msg {
      color: var(--text-secondary);
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .chat-meta {
      text-align: right;
      font-size: 12px;
      color: var(--text-secondary);
    }
    .chat-time {
      margin-bottom: 4px;
    }
    .chat-unread {
      background: var(--accent-color);
      color: #fff;
      border-radius: 12px;
      padding: 2px 6px;
      font-size: 10px;
    }

    /* –û–∫–Ω–æ —á–∞—Ç–∞ */
    .chat-window {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: var(--bg-color);
    }
    .chat-header {
      background: var(--surface-color);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
    }
    .back-btn {
      background: none;
      border: none;
      color: var(--accent-color);
      font-size: 24px;
      margin-right: 12px;
      cursor: pointer;
    }
    .chat-header-info {
      flex: 1;
    }
    .chat-header-name {
      font-weight: 600;
    }
    .chat-header-status {
      font-size: 12px;
      color: var(--text-secondary);
    }
    .messages-area {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
    }
    .message {
      max-width: 80%;
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
    }
    .message.own {
      align-self: flex-end;
    }
    .message-bubble {
      background: var(--message-other);
      border-radius: 18px;
      padding: 8px 12px;
      color: var(--text-primary);
      word-wrap: break-word;
      position: relative;
    }
    .message.own .message-bubble {
      background: var(--message-own);
    }
    .message-time {
      font-size: 10px;
      color: var(--text-secondary);
      margin-top: 2px;
      align-self: flex-end;
    }
    .message.own .message-time {
      color: var(--accent-color);
    }
    .message.own .message-bubble::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: -8px;
      width: 0;
      height: 0;
      border: 8px solid transparent;
      border-top-color: var(--message-own);
      border-bottom: 0;
      border-right: 0;
    }
    .message.other .message-bubble::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: -8px;
      width: 0;
      height: 0;
      border: 8px solid transparent;
      border-top-color: var(--message-other);
      border-bottom: 0;
      border-left: 0;
    }
    .file-message {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .file-icon {
      font-size: 24px;
    }

    /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
    .input-area {
      background: var(--surface-color);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      border-top: 1px solid var(--border-color);
    }
    .attach-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-secondary);
      margin-right: 12px;
      cursor: pointer;
    }
    .input-wrapper {
      flex: 1;
      background: var(--border-color);
      border-radius: 24px;
      padding: 8px 16px;
      display: flex;
      align-items: center;
    }
    .input-wrapper input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      outline: none;
      font-size: 16px;
    }
    .input-wrapper input::placeholder {
      color: var(--text-secondary);
    }
    .emoji-btn, .voice-btn {
      background: none;
      border: none;
      font-size: 22px;
      color: var(--text-secondary);
      margin-left: 8px;
      cursor: pointer;
    }
    .voice-btn.send-btn {
      color: var(--accent-color);
    }
    #file-input {
      display: none;
    }
    .emoji-picker {
      position: absolute;
      bottom: 80px;
      right: 16px;
      background: var(--surface-color);
      border-radius: 24px;
      padding: 12px;
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .emoji-item {
      font-size: 24px;
      cursor: pointer;
      text-align: center;
    }

    /* –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
    .settings-list, .settings-subpage {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    .settings-item {
      display: flex;
      align-items: center;
      padding: 16px;
      background: var(--surface-color);
      border-radius: 12px;
      margin-bottom: 8px;
      cursor: pointer;
    }
    .settings-icon {
      font-size: 24px;
      margin-right: 16px;
    }
    .settings-content {
      flex: 1;
    }
    .settings-title {
      font-weight: 600;
    }
    .settings-subtitle {
      font-size: 12px;
      color: var(--text-secondary);
    }
    .settings-value {
      color: var(--accent-color);
    }
    .theme-option, .lang-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--surface-color);
      border-radius: 12px;
      margin-bottom: 8px;
      cursor: pointer;
    }
    .theme-option.active, .lang-option.active {
      border: 2px solid var(--accent-color);
    }
    .privacy-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      background: var(--surface-color);
      border-radius: 12px;
      margin-bottom: 8px;
    }
    .privacy-switch {
      width: 40px;
      height: 20px;
      background: var(--border-color);
      border-radius: 20px;
      position: relative;
      cursor: pointer;
    }
    .privacy-switch.on {
      background: var(--accent-color);
    }
    .privacy-switch::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      top: 1px;
      left: 1px;
      transition: left 0.2s;
    }
    .privacy-switch.on::after {
      left: 21px;
    }

    /* –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
    .edit-bar {
      background: var(--surface-color);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
    }
    .edit-counter {
      flex: 1;
      font-weight: 600;
    }
    .edit-actions button {
      background: none;
      border: none;
      color: var(--accent-color);
      font-size: 16px;
      margin-left: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body class="dark-theme">
  <div id="main-screen" class="screen active">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è) -->
    <div class="top-bar" id="top-bar">
      <h1 id="screen-title">–ß–∞—Ç—ã</h1>
      <button class="edit-btn" id="edit-btn" onclick="toggleEditMode()">–ò–∑–º.</button>
      <button class="create-btn" id="create-btn" onclick="createGroup()">üìù</button>
    </div>

    <!-- –ü–æ–∏—Å–∫ -->
    <div class="search-box" id="search-box">
      <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫..." oninput="filterChats()">
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–∫—Ä—ã—Ç–∞) -->
    <div id="edit-bar" class="edit-bar" style="display: none;">
      <div class="edit-counter" id="edit-counter">0 –≤—ã–±—Ä–∞–Ω–æ</div>
      <div class="edit-actions">
        <button onclick="deleteSelectedChats()">–£–¥–∞–ª–∏—Ç—å</button>
        <button onclick="doneEditMode()">–ì–æ—Ç–æ–≤–æ</button>
      </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
    <div id="content-area" style="flex: 1; overflow-y: auto;">
      <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
      <div id="chats-view" class="view active">
        <div class="chats-list" id="chats-list"></div>
      </div>

      <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞) -->
      <div id="settings-view" class="view" style="display: none;">
        <div class="settings-list" id="settings-main">
          <div class="settings-item" onclick="openSettingsPage('themes')">
            <div class="settings-icon">üé®</div>
            <div class="settings-content">
              <div class="settings-title" data-i18n="theme">–¢–µ–º–∞</div>
              <div class="settings-subtitle" data-i18n="themeSub">–°–≤–µ—Ç–ª–∞—è / –¢—ë–º–Ω–∞—è</div>
            </div>
            <div class="settings-value" id="current-theme">–¢—ë–º–Ω–∞—è</div>
          </div>
          <div class="settings-item" onclick="openSettingsPage('privacy')">
            <div class="settings-icon">üîí</div>
            <div class="settings-content">
              <div class="settings-title" data-i18n="privacy">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</div>
              <div class="settings-subtitle" data-i18n="privacySub">–ö—Ç–æ –≤–∏–¥–∏—Ç –Ω–æ–º–µ—Ä</div>
            </div>
            <div class="settings-value" id="privacy-summary">...</div>
          </div>
          <div class="settings-item" onclick="openSettingsPage('language')">
            <div class="settings-icon">üåê</div>
            <div class="settings-content">
              <div class="settings-title" data-i18n="language">–Ø–∑—ã–∫</div>
              <div class="settings-subtitle" data-i18n="languageSub">–†—É—Å—Å–∫–∏–π / English</div>
            </div>
            <div class="settings-value" id="current-lang">–†—É—Å—Å–∫–∏–π</div>
          </div>
          <div class="settings-item" onclick="openSettingsPage('about')">
            <div class="settings-icon">‚ÑπÔ∏è</div>
            <div class="settings-content">
              <div class="settings-title" data-i18n="about">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</div>
              <div class="settings-subtitle" data-i18n="aboutSub">–í–µ—Ä—Å–∏—è 1.0</div>
            </div>
          </div>
        </div>

        <!-- –ü–æ–¥—Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç—ã) -->
        <div id="settings-themes" class="settings-subpage" style="display: none;">
          <div class="top-bar">
            <button class="back-btn" onclick="closeSettingsPage()">‚Üê</button>
            <h1>–¢–µ–º–∞</h1>
          </div>
          <div class="settings-list">
            <div class="theme-option" onclick="selectTheme('dark')">
              <span>–¢—ë–º–Ω–∞—è</span>
              <span class="check">‚úì</span>
            </div>
            <div class="theme-option" onclick="selectTheme('light')">
              <span>–°–≤–µ—Ç–ª–∞—è</span>
              <span class="check"></span>
            </div>
            <div class="theme-option" onclick="selectTheme('blue')">
              <span>–°–∏–Ω—è—è</span>
              <span class="check"></span>
            </div>
            <div class="theme-option" onclick="selectTheme('green')">
              <span>–ó–µ–ª—ë–Ω–∞—è</span>
              <span class="check"></span>
            </div>
            <div class="theme-option" onclick="selectTheme('purple')">
              <span>–§–∏–æ–ª–µ—Ç–æ–≤–∞—è</span>
              <span class="check"></span>
            </div>
          </div>
        </div>

        <div id="settings-privacy" class="settings-subpage" style="display: none;">
          <div class="top-bar">
            <button class="back-btn" onclick="closeSettingsPage()">‚Üê</button>
            <h1>–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</h1>
          </div>
          <div class="settings-list">
            <div class="privacy-item">
              <span>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</span>
              <div class="privacy-switch" onclick="togglePrivacy('phone')" id="privacy-phone"></div>
            </div>
            <div class="privacy-item">
              <span>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</span>
              <div class="privacy-switch" onclick="togglePrivacy('lastSeen')" id="privacy-lastSeen"></div>
            </div>
            <div class="privacy-item">
              <span>–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è</span>
              <div class="privacy-switch" onclick="togglePrivacy('photo')" id="privacy-photo"></div>
            </div>
            <div class="privacy-item">
              <span>–°—Ç–∞—Ç—É—Å</span>
              <div class="privacy-switch" onclick="togglePrivacy('status')" id="privacy-status"></div>
            </div>
          </div>
        </div>

        <div id="settings-language" class="settings-subpage" style="display: none;">
          <div class="top-bar">
            <button class="back-btn" onclick="closeSettingsPage()">‚Üê</button>
            <h1>–Ø–∑—ã–∫</h1>
          </div>
          <div class="settings-list">
            <div class="lang-option" onclick="selectLanguage('ru')">
              <span>–†—É—Å—Å–∫–∏–π</span>
              <span class="check">‚úì</span>
            </div>
            <div class="lang-option" onclick="selectLanguage('en')">
              <span>English</span>
              <span class="check"></span>
            </div>
          </div>
        </div>

        <div id="settings-about" class="settings-subpage" style="display: none;">
          <div class="top-bar">
            <button class="back-btn" onclick="closeSettingsPage()">‚Üê</button>
            <h1>–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h1>
          </div>
          <div class="settings-list" style="text-align: center;">
            <p>Zhuravlev Telegram Clone v1.0</p>
            <p>–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏</p>
          </div>
        </div>
      </div>

      <!-- –û–∫–Ω–æ —á–∞—Ç–∞ -->
      <div id="chat-window" class="chat-window" style="display: none;">
        <div class="chat-header">
          <button class="back-btn" onclick="closeChat()">‚Üê</button>
          <div class="chat-header-info">
            <div class="chat-header-name" id="chat-header-name"></div>
            <div class="chat-header-status" id="chat-header-status">–æ–Ω–ª–∞–π–Ω</div>
          </div>
          <button class="edit-btn" style="margin-right: 0;" onclick="showChatMenu()">‚ãÆ</button>
        </div>
        <div class="messages-area" id="messages-area"></div>
        <div class="input-area">
          <button class="attach-btn" onclick="document.getElementById('file-input').click()">üìé</button>
          <div class="input-wrapper">
            <input type="text" id="message-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" oninput="handleTyping()">
            <button class="emoji-btn" onclick="toggleEmojiPicker()">üòÄ</button>
            <button class="voice-btn" id="send-btn" onclick="sendMessage()">üé§</button>
          </div>
        </div>
        <input type="file" id="file-input" onchange="uploadFile()" style="display: none;">
        <div id="emoji-picker" class="emoji-picker" style="display: none;">
          <span class="emoji-item" onclick="addEmoji('üòä')">üòä</span>
          <span class="emoji-item" onclick="addEmoji('üòÇ')">üòÇ</span>
          <span class="emoji-item" onclick="addEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
          <span class="emoji-item" onclick="addEmoji('üëç')">üëç</span>
          <span class="emoji-item" onclick="addEmoji('üî•')">üî•</span>
        </div>
      </div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="bottom-nav">
      <div class="nav-item active" data-view="chats" onclick="switchView('chats')">
        <i>üí¨</i><span data-i18n="chats">–ß–∞—Ç—ã</span>
      </div>
      <div class="nav-item" data-view="settings" onclick="switchView('settings')">
        <i>‚öôÔ∏è</i><span data-i18n="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
      </div>
    </div>
  </div>

  <script>
    // ==================== –î–ê–ù–ù–´–ï ====================
    let chats = [
      { id: 'bot', name: 'Zhuravlev Bot', avatar: 'ü§ñ', lastMessage: '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç', lastTime: new Date(Date.now() - 3600000), unread: 0, isGroup: false },
      { id: 'friends', name: '–î—Ä—É–∑—å—è', avatar: 'üë•', lastMessage: '–ê–Ω—Ç–æ–Ω: –ü—Ä–∏–≤–µ—Ç!', lastTime: new Date(Date.now() - 7200000), unread: 2, isGroup: true, members: ['–ê–Ω—Ç–æ–Ω', '–ú–∞—Ä–∏—è', '–ò–≤–∞–Ω'] },
      { id: 'work', name: '–†–∞–±–æ—Ç–∞', avatar: 'üíº', lastMessage: '–°–æ–±—Ä–∞–Ω–∏–µ –≤ 15:00', lastTime: new Date(Date.now() - 10800000), unread: 0, isGroup: true, members: ['–ü—ë—Ç—Ä', '–ï–ª–µ–Ω–∞'] }
    ];
    let messages = {}; // { chatId: [message, ...] }
    messages['bot'] = [
      { id: 'b1', sender: 'bot', content: '–ü—Ä–∏–≤–µ—Ç! –Ø Zhuravlev Bot ü§ñ', time: new Date(Date.now() - 86400000) },
      { id: 'b2', sender: 'bot', content: '–Ø –º–æ–≥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —ç–º–æ–¥–∑–∏ –∏ —Ñ–∞–π–ª—ã!', time: new Date(Date.now() - 86000000) },
    ];
    messages['friends'] = [
      { id: 'f1', sender: '–ê–Ω—Ç–æ–Ω', content: '–ü—Ä–∏–≤–µ—Ç!', time: new Date(Date.now() - 7200000) },
      { id: 'f2', sender: '–ú–∞—Ä–∏—è', content: '–ö–∞–∫ –¥–µ–ª–∞?', time: new Date(Date.now() - 7100000) },
    ];
    messages['work'] = [
      { id: 'w1', sender: '–ü—ë—Ç—Ä', content: '–°–æ–±—Ä–∞–Ω–∏–µ –≤ 15:00', time: new Date(Date.now() - 10800000) },
    ];

    let currentChat = null;
    let editMode = false;
    let selectedChats = new Set();
    let currentTheme = 'dark';
    let currentLang = 'ru';
    let privacySettings = {
      phone: 'nobody',
      lastSeen: 'everyone',
      photo: 'everyone',
      status: 'everyone'
    };

    const translations = {
      ru: {
        chats: '–ß–∞—Ç—ã',
        settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
        theme: '–¢–µ–º–∞',
        themeSub: '–°–≤–µ—Ç–ª–∞—è / –¢—ë–º–Ω–∞—è',
        privacy: '–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å',
        privacySub: '–ö—Ç–æ –≤–∏–¥–∏—Ç –Ω–æ–º–µ—Ä',
        language: '–Ø–∑—ã–∫',
        languageSub: '–†—É—Å—Å–∫–∏–π / English',
        about: '–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏',
        aboutSub: '–í–µ—Ä—Å–∏—è 1.0',
        edit: '–ò–∑–º.',
        done: '–ì–æ—Ç–æ–≤–æ',
        delete: '–£–¥–∞–ª–∏—Ç—å',
        search: '–ü–æ–∏—Å–∫...',
        online: '–æ–Ω–ª–∞–π–Ω',
        bot: 'Zhuravlev Bot'
      },
      en: {
        chats: 'Chats',
        settings: 'Settings',
        theme: 'Theme',
        themeSub: 'Light / Dark',
        privacy: 'Privacy',
        privacySub: 'Who can see number',
        language: 'Language',
        languageSub: 'Russian / English',
        about: 'About',
        aboutSub: 'Version 1.0',
        edit: 'Edit',
        done: 'Done',
        delete: 'Delete',
        search: 'Search...',
        online: 'online',
        bot: 'Zhuravlev Bot'
      }
    };

    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
    document.addEventListener('DOMContentLoaded', () => {
      renderChats();
      applyTranslations();
    });

    // ==================== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –†–ê–ó–î–ï–õ–û–í ====================
    function switchView(view) {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelector(`[data-view="${view}"]`).classList.add('active');
      document.getElementById('chats-view').style.display = view === 'chats' ? 'block' : 'none';
      document.getElementById('settings-view').style.display = view === 'settings' ? 'block' : 'none';
      if (view === 'chats') {
        document.getElementById('screen-title').textContent = translations[currentLang].chats;
        document.getElementById('edit-btn').style.display = 'inline-block';
        document.getElementById('create-btn').style.display = 'inline-block';
        document.getElementById('search-box').style.display = 'block';
        closeSettingsPage(); // –∑–∞–∫—Ä—ã—Ç—å –ø–æ–¥—Å—Ç—Ä–∞–Ω–∏—Ü—ã
        renderChats();
      } else {
        document.getElementById('screen-title').textContent = translations[currentLang].settings;
        document.getElementById('edit-btn').style.display = 'none';
        document.getElementById('create-btn').style.display = 'none';
        document.getElementById('search-box').style.display = 'none';
      }
    }

    // ==================== –ß–ê–¢–´ ====================
    function renderChats() {
      const list = document.getElementById('chats-list');
      list.innerHTML = '';
      const filter = document.getElementById('search-input').value.toLowerCase();
      const filtered = chats.filter(c => c.name.toLowerCase().includes(filter));
      filtered.forEach(chat => {
        const item = document.createElement('div');
        item.className = `chat-item ${editMode ? 'edit-mode' : ''}`;
        item.dataset.id = chat.id;
        item.onclick = (e) => {
          if (editMode) {
            toggleSelectChat(chat.id, e);
          } else {
            openChat(chat.id);
          }
        };
        const checkbox = document.createElement('div');
        checkbox.className = `chat-checkbox ${selectedChats.has(chat.id) ? 'selected' : ''}`;
        item.appendChild(checkbox);
        item.innerHTML += `
          <div class="chat-avatar">${chat.avatar}</div>
          <div class="chat-info">
            <div class="chat-name">${chat.name}</div>
            <div class="chat-last-msg">${chat.lastMessage}</div>
          </div>
          <div class="chat-meta">
            <div class="chat-time">${formatTime(chat.lastTime)}</div>
            ${chat.unread ? `<div class="chat-unread">${chat.unread}</div>` : ''}
          </div>
        `;
        list.appendChild(item);
      });
    }

    function formatTime(date) {
      return date.toLocaleTimeString('ru', { hour: '2-digit', minute: '2-digit' });
    }

    function filterChats() {
      renderChats();
    }

    // ==================== –†–ï–ñ–ò–ú –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ====================
    function toggleEditMode() {
      editMode = !editMode;
      document.getElementById('edit-bar').style.display = editMode ? 'flex' : 'none';
      document.getElementById('edit-btn').textContent = editMode ? translations[currentLang].done : translations[currentLang].edit;
      if (!editMode) {
        selectedChats.clear();
      }
      renderChats();
    }

    function doneEditMode() {
      toggleEditMode();
    }

    function toggleSelectChat(chatId, event) {
      event.stopPropagation();
      if (selectedChats.has(chatId)) {
        selectedChats.delete(chatId);
      } else {
        selectedChats.add(chatId);
      }
      document.getElementById('edit-counter').textContent = `${selectedChats.size} –≤—ã–±—Ä–∞–Ω–æ`;
      renderChats(); // –æ–±–Ω–æ–≤–∏—Ç—å —á–µ–∫–±–æ–∫—Å—ã
    }

    function deleteSelectedChats() {
      chats = chats.filter(c => !selectedChats.has(c.id));
      selectedChats.clear();
      toggleEditMode(); // –≤—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞
    }

    // ==================== –ß–ê–¢ –° –ë–û–¢–û–ú/–ì–†–£–ü–ü–û–ô ====================
    function openChat(chatId) {
      currentChat = chatId;
      const chat = chats.find(c => c.id === chatId);
      document.getElementById('chat-header-name').textContent = chat.name;
      document.getElementById('chat-header-status').textContent = translations[currentLang].online;
      document.getElementById('chats-view').style.display = 'none';
      document.getElementById('settings-view').style.display = 'none';
      document.getElementById('chat-window').style.display = 'flex';
      document.getElementById('top-bar').style.display = 'none';
      document.getElementById('search-box').style.display = 'none';
      document.getElementById('edit-bar').style.display = 'none';
      renderMessages(chatId);
    }

    function closeChat() {
      currentChat = null;
      document.getElementById('chat-window').style.display = 'none';
      document.getElementById('chats-view').style.display = 'block';
      document.getElementById('top-bar').style.display = 'flex';
      document.getElementById('search-box').style.display = 'block';
      if (editMode) {
        document.getElementById('edit-bar').style.display = 'flex';
      }
    }

    function renderMessages(chatId) {
      const area = document.getElementById('messages-area');
      area.innerHTML = '';
      const msgs = messages[chatId] || [];
      msgs.forEach(msg => {
        const isOwn = msg.sender === 'me';
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${isOwn ? 'own' : 'other'}`;
        let contentHtml = msg.type === 'file' ?
          `<div class="file-message"><span class="file-icon">üìé</span><span>${msg.fileName}</span></div>` :
          `<div>${escapeHtml(msg.content)}</div>`;
        msgDiv.innerHTML = `
          <div class="message-bubble">${contentHtml}</div>
          <div class="message-time">${formatTime(msg.time)}</div>
        `;
        area.appendChild(msgDiv);
      });
      scrollToBottom();
    }

    function sendMessage() {
      const input = document.getElementById('message-input');
      const content = input.value.trim();
      if (!content || !currentChat) return;
      const newMsg = {
        id: Date.now().toString(),
        sender: 'me',
        content,
        time: new Date(),
        type: 'text'
      };
      if (!messages[currentChat]) messages[currentChat] = [];
      messages[currentChat].push(newMsg);
      renderMessages(currentChat);
      input.value = '';
      document.getElementById('send-btn').className = 'voice-btn';
      document.getElementById('send-btn').textContent = 'üé§';

      // –û—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞ –∏–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≥—Ä—É–ø–ø—ã (–∏–º–∏—Ç–∞—Ü–∏—è)
      setTimeout(() => {
        const chat = chats.find(c => c.id === currentChat);
        let replySender = 'bot';
        let replyContent = generateBotReply(content);
        if (chat.isGroup) {
          const members = chat.members || [];
          replySender = members[Math.floor(Math.random() * members.length)];
          replyContent = `–ü—Ä–∏–Ω—è–ª: "${content}" ‚Äî ${replySender}`;
        }
        const reply = {
          id: (Date.now() + 1).toString(),
          sender: replySender,
          content: replyContent,
          time: new Date(),
          type: 'text'
        };
        messages[currentChat].push(reply);
        renderMessages(currentChat);
        // –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ
        const chatObj = chats.find(c => c.id === currentChat);
        if (chatObj) {
          chatObj.lastMessage = replyContent.length > 30 ? replyContent.slice(0,30)+'‚Ä¶' : replyContent;
          chatObj.lastTime = new Date();
        }
      }, 1000);
    }

    function generateBotReply(text) {
      if (text.includes('–ø—Ä–∏–≤–µ—Ç')) return '–ò —Ç–µ–±–µ –ø—Ä–∏–≤–µ—Ç!';
      if (text.includes('–∫–∞–∫ –¥–µ–ª–∞')) return '–û—Ç–ª–∏—á–Ω–æ!';
      if (text.includes('–±–æ—Ç')) return '–Ø –ø—Ä–æ—Å—Ç–æ –±–æ—Ç';
      return '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ...';
    }

    function uploadFile() {
      const file = document.getElementById('file-input').files[0];
      if (!file || !currentChat) return;
      const newMsg = {
        id: Date.now().toString(),
        sender: 'me',
        content: `üìé ${file.name}`,
        fileName: file.name,
        time: new Date(),
        type: 'file'
      };
      messages[currentChat].push(newMsg);
      renderMessages(currentChat);
      setTimeout(() => {
        const reply = {
          id: (Date.now() + 1).toString(),
          sender: 'bot',
          content: `–§–∞–π–ª "${file.name}" –ø–æ–ª—É—á–µ–Ω!`,
          time: new Date(),
          type: 'text'
        };
        messages[currentChat].push(reply);
        renderMessages(currentChat);
      }, 1000);
    }

    function handleTyping() {
      const input = document.getElementById('message-input');
      const btn = document.getElementById('send-btn');
      if (input.value.trim()) {
        btn.className = 'voice-btn send-btn';
        btn.textContent = '‚û§';
      } else {
        btn.className = 'voice-btn';
        btn.textContent = 'üé§';
      }
    }

    function toggleEmojiPicker() {
      const picker = document.getElementById('emoji-picker');
      picker.style.display = picker.style.display === 'none' ? 'grid' : 'none';
    }

    function addEmoji(emoji) {
      document.getElementById('message-input').value += emoji;
      document.getElementById('message-input').focus();
      handleTyping();
    }

    function scrollToBottom() {
      const area = document.getElementById('messages-area');
      area.scrollTop = area.scrollHeight;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showChatMenu() {
      alert('–ú–µ–Ω—é —á–∞—Ç–∞ (–∑–∞–≥–ª—É—à–∫–∞)');
    }

    // ==================== –°–û–ó–î–ê–ù–ò–ï –ì–†–£–ü–ü–´ ====================
    function createGroup() {
      const name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã:');
      if (!name) return;
      const newGroup = {
        id: 'group' + Date.now(),
        name,
        avatar: 'üë•',
        lastMessage: '–ì—Ä—É–ø–ø–∞ —Å–æ–∑–¥–∞–Ω–∞',
        lastTime: new Date(),
        unread: 0,
        isGroup: true,
        members: ['–í—ã']
      };
      chats.push(newGroup);
      messages[newGroup.id] = [{ id: 'g1', sender: 'system', content: '–ì—Ä—É–ø–ø–∞ —Å–æ–∑–¥–∞–Ω–∞', time: new Date() }];
      renderChats();
    }

    // ==================== –ù–ê–°–¢–†–û–ô–ö–ò ====================
    function openSettingsPage(page) {
      document.getElementById('settings-main').style.display = 'none';
      document.getElementById('settings-' + page).style.display = 'block';
      document.getElementById('top-bar').style.display = 'none';
      // –æ–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é —Ç–µ–º—É
      if (page === 'themes') {
        document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
        document.querySelector(`.theme-option[onclick*="${currentTheme}"]`).classList.add('active');
      }
      if (page === 'language') {
        document.querySelectorAll('.lang-option').forEach(opt => opt.classList.remove('active'));
        document.querySelector(`.lang-option[onclick*="${currentLang}"]`).classList.add('active');
      }
      if (page === 'privacy') {
        updatePrivacySwitches();
      }
    }

    function closeSettingsPage() {
      document.getElementById('settings-main').style.display = 'block';
      document.getElementById('settings-themes').style.display = 'none';
      document.getElementById('settings-privacy').style.display = 'none';
      document.getElementById('settings-language').style.display = 'none';
      document.getElementById('settings-about').style.display = 'none';
      document.getElementById('top-bar').style.display = 'flex';
    }

    function selectTheme(theme) {
      currentTheme = theme;
      document.body.className = theme + '-theme';
      document.getElementById('current-theme').textContent = theme === 'dark' ? '–¢—ë–º–Ω–∞—è' : theme === 'light' ? '–°–≤–µ—Ç–ª–∞—è' : theme === 'blue' ? '–°–∏–Ω—è—è' : theme === 'green' ? '–ó–µ–ª—ë–Ω–∞—è' : '–§–∏–æ–ª–µ—Ç–æ–≤–∞—è';
      closeSettingsPage();
    }

    function selectLanguage(lang) {
      currentLang = lang;
      document.getElementById('current-lang').textContent = lang === 'ru' ? '–†—É—Å—Å–∫–∏–π' : 'English';
      applyTranslations();
      closeSettingsPage();
    }

    function applyTranslations() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[currentLang][key]) {
          el.textContent = translations[currentLang][key];
        }
      });
      document.getElementById('edit-btn').textContent = translations[currentLang].edit;
      document.getElementById('search-input').placeholder = translations[currentLang].search;
    }

    function togglePrivacy(item) {
      // –ü—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª/–≤—ã–∫–ª
      const sw = document.getElementById(`privacy-${item}`);
      sw.classList.toggle('on');
    }

    function updatePrivacySwitches() {
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ privacySettings
    }
  </script>
</body>
</html>
